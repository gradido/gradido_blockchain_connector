
#########################################################################################################
# Prepare debug 
#########################################################################################################
FROM gradido/cpp_dependencies:gcc9-debug-1.0 as prepare_debug

ENV DOCKER_WORKDIR="/code"
WORKDIR ${DOCKER_WORKDIR}

RUN echo '/usr/local/lib' >> /etc/ld.so.conf && ldconfig

COPY ./CMakeLists.txt.lib ./CMakeLists.txt
COPY ./dependencies/gradido_blockchain ./dependencies/gradido_blockchain
COPY ./dependencies/gradido_blockchain/CMakeLists.txt.lib ./dependencies/gradido_blockchain/CMakeLists.txt
RUN rm -rf ./dependencies/gradido_blockchain/build
RUN ln -s /usr/local/googletest ./googletest
COPY ./src ./src

	
#########################################################################################################
# Build debug 
#########################################################################################################
FROM prepare_debug as debug

ENV DOCKER_WORKDIR="/code"
WORKDIR ${DOCKER_WORKDIR}

RUN mkdir build && \
	cd build && \
	cmake -DCMAKE_BUILD_TYPE=Debug ..

RUN mkdir ~/.gradido && cd ~/.gradido && wget --no-check-certificate https://curl.se/ca/cacert.pem

CMD cd build && cmake .. -DCMAKE_BUILD_TYPE=Debug && make -j$(nproc) GradidoBlockchainConnector && ./bin/GradidoBlockchainConnector

